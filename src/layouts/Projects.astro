---
import type { CollectionEntry } from 'astro:content';
import Base from './Base.astro';
import projectsData from '../content/page/projects.json';

type Props = CollectionEntry<'page'>['data'] & {
	content?: string;
};

const { title } = Astro.props;

// 定义项目类型
interface Project {
	name: string;
	description: string;
	url: string;
	image?: string;
	tags?: string[];
}

// 读取项目数据
const projects: Project[] = projectsData;

// 默认图片
const defaultImage = '/logo.png';
---

<Base title={title} description={title}>
	<p></p>
	<h2>–</h2>
	<h1>{title}</h1>
	<div class='post-content content'>
		<slot />
	</div>

	<div class='projects-container'>
		<!-- 项目列表 -->
		<div class='projects-grid'>
			{
				projects.length === 0 ? (
					<div class='empty-state'>暂无项目数据</div>
				) : (
					projects.map((project) => (
						<div class='card'>
							<a href={project.url || '#'} class='card-image' target='_blank' rel='noopener noreferrer'>
								<img src={project.image || defaultImage} alt={project.name} loading='lazy' />
							</a>
							<div class='card-content'>
								<h2 class='card-title'>
									<a href={project.url || '#'} target='_blank' rel='noopener noreferrer'>
										{project.name || '未命名项目'}
									</a>
								</h2>
								<p class='card-description'>{project.description}</p>
								{project.tags && project.tags.length > 0 && (
									<div class='card-tags'>
										{project.tags.map((tag) => (
											<span class='tag'>{tag}</span>
										))}
									</div>
								)}
							</div>
						</div>
					))
				)
			}
		</div>

		<h2 class='section-title'>GitHub Activity</h2>

		<!-- GitHub 活动 -->
		<section class='github-activity'>
			<div class='github-activity__chart'>
				<img
					src='https://ghchart.rshah.org/659eb9/lynkxu'
					alt='GitHub activity chart'
					loading='lazy'
				/>
			</div>
		</section>
	</div>
</Base>

<style>
	.projects-container .projects-grid {
		display: grid;
		grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
		gap: 1.5rem;
		align-items: stretch;
	}

	.projects-container .github-activity {
		margin-top: 2rem;
		background: var(--code-background-color);
		border-radius: 8px;
		padding: 12px;
		border: 1px solid rgba(127, 127, 127, 0.1);
	}

	.projects-container .github-activity__chart {
		margin-top: 10px;
		border-radius: 4px;
		overflow: hidden;
	}

	.projects-container .github-activity__chart img {
		width: 100%;
		display: block;
		border-radius: 4px;
		border: none;
		background: transparent;
		padding: 0;
		box-shadow: none;
	}

	.projects-container .section-title {
		margin: 2rem 0 1rem;
		font-size: 1.2rem;
		font-weight: 600;
		color: var(--heading-color);
	}

	.projects-container .card {
		position: relative;
		background: var(--background-color);
		border-radius: 8px;
		overflow: hidden;
		border: 1px solid rgba(127, 127, 127, 0.15);
		transition: all 0.3s ease;
		display: flex;
		flex-direction: column;
	}

	.projects-container .card:hover {
		transform: translateY(-2px);
		border-color: var(--link-color);
		box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
	}

	.projects-container .card-image {
		display: flex;
		width: 100%;
		aspect-ratio: 16/9;
		overflow: hidden;
		border-bottom: 1px solid rgba(127, 127, 127, 0.1);
		background-color: var(--code-background-color);
	}

	.projects-container .card-image img {
		width: 100%;
		height: 100%;
		object-fit: cover;
		transition: transform 0.5s ease;
	}

	.projects-container .card:hover .card-image img {
		transform: scale(1.02);
	}

	.projects-container .card-content {
		padding: 1rem;
		display: flex;
		flex-direction: column;
		gap: 0.5rem;
		flex: 1;
	}

	.projects-container .card-title {
		margin: 0;
		color: var(--heading-color);
		font-weight: 600;
		font-size: 1.1rem;
		line-height: 1.4;
	}

	.projects-container .card-title a {
		color: inherit;
		text-decoration: none;
		border: none;
	}

	.projects-container .card-description {
		color: var(--gray-color);
		font-size: 0.95rem;
		line-height: 1.6;
		margin: 0.2rem 0 0.5rem;
		font-weight: normal;
		flex-grow: 1;
	}

	.projects-container .error-message {
		grid-column: 1/-1;
		text-align: center;
		padding: 30px;
		background: rgba(245, 108, 108, 0.1);
		color: #f56c6c;
		border-radius: 8px;
		font-size: 1rem;
	}

	.projects-container .empty-state {
		grid-column: 1/-1;
		text-align: center;
		padding: 40px;
		color: var(--gray-color);
		font-size: 1rem;
		background: var(--code-background-color);
		border-radius: 8px;
	}

	.projects-container .card-tags {
		display: flex;
		flex-wrap: wrap;
		gap: 8px;
		margin-top: auto;
	}

	.projects-container .tag {
		display: inline-block;
		padding: 2px 8px;
		font-size: 0.8rem;
		border-radius: 4px;
		background-color: var(--code-background-color);
		color: var(--text-color);
		font-weight: normal;
		transition: all 0.2s ease;
		line-height: 1.5;
		border: 1px solid transparent;
	}

	.projects-container .tag:hover {
		background-color: rgba(127, 127, 127, 0.1);
		border-color: rgba(127, 127, 127, 0.2);
	}

	@media (max-width: 768px) {
		.projects-container .projects-grid {
			grid-template-columns: 1fr;
		}
	}
</style>
