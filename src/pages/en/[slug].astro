---
import { type CollectionEntry, getCollection, render } from 'astro:content';
import Page from '../../layouts/Page.astro';
import About from '../../layouts/About.astro';
import Message from '../../layouts/Message.astro';
import Shuoshuo from '../../layouts/Shuoshuo.astro';
import Projects from '../../layouts/Projects.astro';
import Sports from '../../layouts/Sports.astro';

export async function getStaticPaths() {
	const pages = (await getCollection('page')).filter(p => p.id.startsWith('en/'));
	const paths: Array<{ params: { slug: string }; props: CollectionEntry<'page'> }> = [];

	pages.forEach((page) => {
		// 添加主 slug
		paths.push({
			params: { slug: page.data.slug },
			props: page,
		});

		// 添加所有别名 slug
		if (page.data.aliases && Array.isArray(page.data.aliases)) {
			page.data.aliases.forEach((alias) => {
				paths.push({
					params: { slug: alias },
					props: page,
				});
			});
		}
	});

	return paths;
}

type Props = CollectionEntry<'page'>;

const page = Astro.props;
const { Content } = await render(page);

// 布局映射表
const layoutMap: Record<string, any> = {
	Page, // 默认布局
	About,
	Message,
	Shuoshuo,
	Projects,
	Sports,
};

// 根据 layout / pageLayout 字段选择布局组件
const layoutKey = (page.data.pageLayout || page.data.layout) as string | undefined;
const Layout = (layoutKey && layoutMap[layoutKey]) || Page;
---

<Layout title={page.data.title}>
	<Content />
</Layout>


